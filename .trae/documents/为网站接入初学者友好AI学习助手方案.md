## 总体目标

* 为站点提供一个“会教学的AI助手”，以引导式学习为核心，结合站内资源与在线工具，面向初学者逐步讲解与练习，不做泛化闲聊。

* 优先支持中文，强调“诊断→引导→练习→反馈→引用来源”的教学闭环。

## 用户体验与教学策略

* 入门友好：支持“入门/进阶”难度切换，默认入门模式给出更细颗粒提示与图示。

* 诊断式对话：回答前先提出1–2个简短诊断题，识别基础掌握情况与误区。

* 引导式讲解：采用“Socratic”分步提问与逐步提示（Hint→Step→Answer），避免一上来给最终答案。

* 练习生成：自动生成微练习（选择/填空/推导），支持逐步揭示答案与关键思路。

* 工具联动：在适当时建议跳到 `tools/*.html` 页面进行验证（如刚度矩阵、Gauss积分、形函数）并返回结论。

* 引用与溯源：每次讲解附上站内 `resources/*.html` 或外部权威链接，避免无依据内容。

* 轻量进度：利用 `localStorage` 记录学习主题、掌握度、错题与复习时间，支持导出/清除，无需登录。

## 关键功能

* 学习助手入口：在导航栏新增“学习助手”入口（或悬浮按钮），打开侧边或独立页的教学对话面板。

* 模式切换：提问、学习路径、练习、错题复习四个模式，快速切换工作流。

* 学习路径生成：根据主题（如“一维杆单元刚度推导”）生成先修→核心→练习→巩固的路径，并映射到站内资源。

* 练习与评测：生成题目、解析与再练建议；将错题归档并安排间隔复习（简版SR）。

* 引用与证据：所有回答附带“参考资料”区块，优先站内资源与权威外链。

* 响应流式：前端支持流式显示，先出现诊断与提示，再逐步展开讲解与引用。

## 技术架构

* 前端：

  * 新增 `js/tutor.js`（或并入 `js/main.js`）实现聊天UI、模式切换、进度记录、与后端通信。

  * 新增 `tutor.html` 或在 `index.html` 注入侧边面板；使用现有 Bootstrap 与站点样式。

  * 本地进度：`localStorage` 存储 `profile`（目标、水平、时间）、`progress`（主题掌握度、错题）。

* 后端（Vercel Serverless Functions）：

  * `api/tutor.js`：统一对话编排与模型调用；服务端持有 API Key；返回教学结构化回复（诊断/提示/讲解/练习/引用）。

  * `api/resources-search.js`：基于 `data/resources.json` 的关键词检索与标签过滤，返回可引用的站内资源条目。

  * `api/lesson-plan.js`：生成学习路径（主题→先修→核心→练习→巩固），并关联资源条目与工具页。

  * 可选 `api/assess.js`：生成评测题与自动评阅，输出分项反馈与再练建议。

* 模型抽象：

  * 默认 `OpenAI`（`gpt-4o-mini` 或 `o3-mini`）以控制成本与推理质量；保留 `provider` 抽象以便切换（如 DeepSeek/Azure/OpenRouter）。

  * 严禁在前端暴露密钥；全部调用走服务端；支持 SSE 流式响应。

## 数据与知识来源

* 站内资源：使用 `data/resources.json` 作为首要知识库；回复时优先引用站内分类页与工具页。

* 外部权威：MIT/Stanford课程、官方文档、GitHub仓库；仅附链接与简介，不缓存全文。

* 私密资料（可选后续）：通过 `@vercel/blob` 上传PDF到私有存储，后端做检索摘要（仅元数据与片段），遵守合规与隐私。

## 教学角色与提示词策略

* 角色：

  * “计算力学入门教师”，用中文，语气友好，强调概念→例子→练习。

* 回复结构：

  * <br />

    1. 诊断问题（1–2个）

  * <br />

    1. 逐步提示（从概念到推导）

  * <br />

    1. 微练习（带答案揭示开关）

  * <br />

    1. 建议使用站内工具验证

  * <br />

    1. 参考资料（站内优先，外部权威）

* 约束：必须引用来源；避免跳步给最终答案；发现误区要先纠正再继续。

## 隐私与合规

* 后端保存最小化会话数据（默认不持久化）；仅使用前端 `localStorage` 做进度记录。

* 不收集身份信息；允许导出/删除本地学习记录。

* 外部引用遵循版权与平台政策；不抓取受限内容；仅保留公开链接与元数据。

## 里程碑

* M1（教学聊天最小可用）：

  * UI入口与对话面板；`api/tutor` 打通；站内资源引用；流式响应。

* M2（学习路径与练习）：

  * `api/lesson-plan` 与模式切换；微练习与错题归档；工具页联动。

* M3（评测与复习）：

  * 评测题与分项反馈；简版间隔复习；进度仪表与建议。

* M4（私密资料可选）：

  * 文档上传与片段检索；严格合规；仅个人学习用途。

## 验收标准

* 回答结构完整且含引用；默认入门模式提供可操作的引导与练习。

* 站内资源引用覆盖率≥70%；工具联动建议出现率≥50%（相关主题）。

* 性能：首条响应延迟≤2s（流式）；整体对话成本可控。

## 配置需求

* 环境变量：`AI_PROVIDER`、`AI_API_KEY`、可选 `OPENAI_API_BASE`。

* 后端启用 SSE；前端适配流式展示与模式切换；`resources.json` 保持已发布结构。

请确认该方案。如果确认，我将按里程碑启动 M1（仅增补前后端接口与UI入口，不改变现有页面结构的主要内容），并在完成后演示“学习助手”基础版及其与站内资源/工具的联动效果。
